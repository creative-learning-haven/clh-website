---
import Layout from "../layouts/Layout.astro";
import page000 from "../assets/art/page-000.avif";
import page001 from "../assets/art/page-001.avif";
import page002 from "../assets/art/page-002.avif";
import page003 from "../assets/art/page-003.avif";
import page004 from "../assets/art/page-004.avif";
import page005 from "../assets/art/page-005.avif";
import page006 from "../assets/art/page-006.avif";
import page007 from "../assets/art/page-007.avif";
import page008 from "../assets/art/page-008.avif";
import page009 from "../assets/art/page-009.avif";
import page010 from "../assets/art/page-010.avif";
import page011 from "../assets/art/page-011.avif";
import page012 from "../assets/art/page-012.avif";
import page013 from "../assets/art/page-013.avif";
import page014 from "../assets/art/page-014.avif";
import page015 from "../assets/art/page-015.avif";
import page016 from "../assets/art/page-016.avif";
import page017 from "../assets/art/page-017.avif";
import page018 from "../assets/art/page-018.avif";

const images = [
  page000, page001, page002, page003, page004,
  page005, page006, page007, page008, page009,
  page010, page011, page012, page013, page014,
  page015, page016, page017, page018
];
---

<Layout>
  <div class="art-page">
    <div class="art-header">
      <h1>Art Gallery</h1>
      <p>Artwork from Creative Learning Haven artists Lemi Arima Joseph, Emmanuel Lupa, Moses Malish, John Mambo, Meta Richard, and Lemi Samuel.</p>
    </div>

    <div class="art-grid">
      {images.map((img, index) => (
        <div class="art-item" data-index={index} data-src={img.src}>
          <img 
            src={img.src} 
            alt={`Artwork ${index + 1}`}
            loading="lazy"
          />
        </div>
      ))}
    </div>

    <!-- Image Viewer Overlay -->
    <div class="image-viewer" id="image-viewer">
      <button class="viewer-close" id="viewer-close" aria-label="Close viewer">
        <span class="close-icon">×</span>
      </button>
      <button class="viewer-nav viewer-nav-left" id="viewer-nav-left" aria-label="Previous image">
        <span class="arrow">‹</span>
      </button>
      <button class="viewer-nav viewer-nav-right" id="viewer-nav-right" aria-label="Next image">
        <span class="arrow">›</span>
      </button>
      <div class="viewer-content">
        <img id="viewer-image" src="" alt="" />
      </div>
    </div>
  </div>
</Layout>

<style>
  .art-page {
    max-width: 1200px;
    margin: 0 auto;
    padding: 40px 20px;
  }

  .art-header {
    text-align: center;
    margin-bottom: 40px;
  }

  .art-header h1 {
    font-size: 2.5em;
    margin-bottom: 10px;
    color: var(--color-ink);
  }

  .art-header p {
    font-size: 1.1em;
    color: var(--color-ink);
    opacity: 0.8;
  }

  .art-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
  }

  .art-item {
    position: relative;
    overflow: hidden;
    border-radius: 8px;
    cursor: pointer;
    aspect-ratio: 1;
    background: var(--section-light);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .art-item:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
  }

  .art-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  /* Image Viewer Styles */
  .image-viewer {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    z-index: 2000;
    align-items: center;
    justify-content: center;
  }

  .image-viewer.active {
    display: flex;
  }

  .viewer-content {
    position: relative;
    max-width: 90%;
    max-height: 90%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .viewer-content img {
    max-width: 100%;
    max-height: 90vh;
    object-fit: contain;
    border-radius: 4px;
  }

  .viewer-close {
    position: absolute;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    font-size: 2.5em;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s ease;
    z-index: 2001;
    padding: 0;
    font-family: Arial, sans-serif;
  }

  .viewer-close .close-icon {
    display: block;
    line-height: 1;
    transform: translateY(1px); // hack to get the X centered in the circle
  }

  .viewer-close:hover {
    background: rgba(255, 255, 255, 0.3);
  }

  .viewer-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    font-size: 3em;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s ease;
    z-index: 2001;
    padding: 0;
    font-family: Arial, sans-serif;
  }

  .viewer-nav .arrow {
    display: block;
    line-height: 1;
    transform: translateY(-2px);
  }

  .viewer-nav:hover {
    background: rgba(255, 255, 255, 0.3);
  }

  .viewer-nav-left {
    left: 20px;
  }

  .viewer-nav-right {
    right: 20px;
  }

  @media (max-width: 768px) {
    .art-grid {
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
    }

    .art-header h1 {
      font-size: 2em;
    }

    .viewer-nav {
      width: 50px;
      height: 50px;
      font-size: 2.5em;
    }

    .viewer-nav-left {
      left: 10px;
    }

    .viewer-nav-right {
      right: 10px;
    }

    .viewer-close {
      top: 10px;
      right: 10px;
      width: 40px;
      height: 40px;
      font-size: 2em;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const viewer = document.getElementById('image-viewer');
    const viewerImageEl = document.getElementById('viewer-image');
    const viewerImage = viewerImageEl instanceof HTMLImageElement ? viewerImageEl : null;
    const viewerClose = document.getElementById('viewer-close');
    const viewerNavLeft = document.getElementById('viewer-nav-left');
    const viewerNavRight = document.getElementById('viewer-nav-right');
    const artItems = document.querySelectorAll('.art-item');

    // Collect all image sources from data attributes
    const images = Array.from(artItems).map(item => ({
      src: item.getAttribute('data-src') || ''
    }));

    let currentIndex = 0;

    function openViewer(index: number) {
      currentIndex = index;
      if (viewerImage && images[currentIndex]) {
        viewerImage.src = images[currentIndex].src;
        viewerImage.alt = `Artwork ${currentIndex + 1}`;
      }
      if (viewer) {
        viewer.classList.add('active');
      }
      document.body.style.overflow = 'hidden';
      updateNavButtons();
    }

    function closeViewer() {
      if (viewer) {
        viewer.classList.remove('active');
      }
      document.body.style.overflow = '';
    }

    function updateNavButtons() {
      if (viewerNavLeft && viewerNavRight) {
        viewerNavLeft.style.opacity = currentIndex === 0 ? '0.5' : '1';
        viewerNavRight.style.opacity = currentIndex === images.length - 1 ? '0.5' : '1';
        viewerNavLeft.style.pointerEvents = currentIndex === 0 ? 'none' : 'auto';
        viewerNavRight.style.pointerEvents = currentIndex === images.length - 1 ? 'none' : 'auto';
      }
    }

    function showNext() {
      if (currentIndex < images.length - 1) {
        currentIndex++;
        if (viewerImage && images[currentIndex]) {
          viewerImage.src = images[currentIndex].src;
          viewerImage.alt = `Artwork ${currentIndex + 1}`;
        }
        updateNavButtons();
      }
    }

    function showPrevious() {
      if (currentIndex > 0) {
        currentIndex--;
        if (viewerImage && images[currentIndex]) {
          viewerImage.src = images[currentIndex].src;
          viewerImage.alt = `Artwork ${currentIndex + 1}`;
        }
        updateNavButtons();
      }
    }

    // Open viewer on image click
    artItems.forEach((item, index) => {
      item.addEventListener('click', () => openViewer(index));
    });

    // Close viewer
    if (viewerClose) {
      viewerClose.addEventListener('click', closeViewer);
    }
    if (viewer) {
      viewer.addEventListener('click', (e) => {
        if (e.target === viewer) {
          closeViewer();
        }
      });
    }

    // Navigation buttons
    if (viewerNavLeft) {
      viewerNavLeft.addEventListener('click', (e) => {
        e.stopPropagation();
        showPrevious();
      });
    }

    if (viewerNavRight) {
      viewerNavRight.addEventListener('click', (e) => {
        e.stopPropagation();
        showNext();
      });
    }

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (!viewer || !viewer.classList.contains('active')) return;

      if (e.key === 'Escape') {
        closeViewer();
      } else if (e.key === 'ArrowLeft') {
        showPrevious();
      } else if (e.key === 'ArrowRight') {
        showNext();
      }
    });
  });
</script>
