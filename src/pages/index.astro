---
import Layout from '../layouts/Layout.astro';
import heroImg from '../assets/P1090543.jpg';
---

<Layout>
	<section class="hero" style={`--hero-image: url(${heroImg.src})`}>
		<div class="hero-inner">
			<h1>
				<span>Knowledge is</span>
				<span class="line2">Peace</span>
			</h1>
			<p class="tagline">Creative Learning Haven is a community library project in Uganda's Rhino and Imvepi Refugee Settlements.</p>
			<p class="subtitle">Free access to reading and creative activities will change the futures of refugees and local communities in Uganda.</p>
		</div>
	</section>

	<section class="panels">
		<div class="panel mission">
			<h2>Our Mission</h2>
			<p>When formal education is unreliable, <strong>one must be able to learn independently</strong>. Our libraries provide materials and space for independent learning, helping learners in struggling schools and curious adults continue to grow.</p>
			<a class="link" href="/about">Read more</a>
		</div>
		<div class="panel pledge">
			<h2>Take a pledge!</h2>
			<a class="cta" href="/support-us">Support Us</a>
		</div>
		<div class="panel socials">
			<h2>Our Socials</h2>
			<p>Follow our journey in starting community libraries in Rhino and Imvepi Refugee Settlements.</p>
			<a class="link" href="/blog">Read more</a>
		</div>
		<div class="panel subscribe">
			<h2>Subscribe</h2>
			<p>Subscribe to our Newsletter</p>
			<form class="subscribe-form" method="POST" data-netlify="true">
				<input type="hidden" name="form-name" value="newsletter-subscribe" />
				<input type="email" name="email" placeholder="Email address" required />
				<button type="submit">Subscribe</button>
			</form>
			<div class="form-message" id="form-message"></div>
		</div>
	</section>

	<script>
		document.addEventListener('DOMContentLoaded', function() {
			const form = document.querySelector('.subscribe-form') as HTMLFormElement;
			const messageDiv = document.getElementById('form-message');
			
			if (!form || !messageDiv) return;
			
			form.addEventListener('submit', async function(e) {
				e.preventDefault();
				
				const emailInput = form.querySelector('input[name="email"]') as HTMLInputElement;
				const submitButton = form.querySelector('button[type="submit"]') as HTMLButtonElement;
				
				if (!emailInput || !submitButton) return;
				
				// Show loading state
				submitButton.textContent = 'Subscribing...';
				submitButton.disabled = true;
				messageDiv.textContent = '';
				
				try {
					// Submit form data
					const formData = new FormData(form);
					const response = await fetch('/', {
						method: 'POST',
						body: formData
					});
					
					if (response.ok) {
						messageDiv.textContent = 'Thank you for subscribing!';
						messageDiv.className = 'form-message success';
						form.reset();
					} else {
						throw new Error('Submission failed');
					}
				} catch (error) {
					messageDiv.textContent = 'Something went wrong. Please try again.';
					messageDiv.className = 'form-message error';
				} finally {
					submitButton.textContent = 'Subscribe';
					submitButton.disabled = false;
				}
			});
		});
	</script>

<h2 class="activities-title">OUR ACTIVITIES</h2>
</Layout>

<style>
	.hero {
		position: relative;
		min-height: 68vh;
		/* top: fade into white; middle: dark overlay; bottom: image */
		background-image:
			linear-gradient(to bottom, rgba(255,255,255,0) 84%, rgba(255,255,255,0.9) 96%, var(--color-white) 100%),
			linear-gradient(180deg, var(--overlay-dark) 0%, var(--overlay-dark) 100%),
			var(--hero-image);
		background-size: 100% 100%, 100% 100%, 100% auto; /* overlays cover, image fits width */
		background-position: center top, center top, center top;
		background-repeat: no-repeat, no-repeat, no-repeat;
		color: white;
		display: grid;
		place-items: center;
		z-index: 0;
	}

	.hero-inner {
		max-width: 940px;
		padding: 6vh 16px 8vh;
		text-align: center;
	}

	/* Staggered rise-in animation for hero content (slower + stronger) */
	.hero-inner > * {
		opacity: 0;
		transform: translateY(100px);
		animation: riseIn 1.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
	}

	.hero-inner > *:nth-child(1) { animation-delay: .15s; }
	.hero-inner > *:nth-child(2) { animation-delay: .35s; }
	.hero-inner > *:nth-child(3) { animation-delay: .55s; }

	@keyframes riseIn {
		from { opacity: 0; transform: translateY(60px); filter: blur(4px); }
		to { opacity: 1; transform: translateY(0); filter: blur(0); }
	}

	@media (prefers-reduced-motion: reduce) {
		.hero-inner > * { animation: none; opacity: 1; transform: none; filter: none; }
	}

	.tagline {
		display: inline-block;
		font-size: 1.2em;
		max-width: 700px;
		padding: 8px 14px;
		border-radius: 10px;
		letter-spacing: .08em;
		font-weight: 800; // uses Avenir Heavy
	}

	h1 {
		margin: 10px 0 6px;
		font-size: clamp(34px, 7vw, 76px);
		line-height: 0.95;
		text-transform: uppercase;
	}

	.line2 { display: block; font-size: 1.1em; }

	.subtitle {
		max-width: 780px;
		margin: 12px auto 0;
		font-size: clamp(16px, 2.2vw, 20px);
		color: var(--white-strong);
		text-shadow: 0 1px 2px rgba(0,0,0,0.25);
	}

	.panels {
		display: grid;
		/* Left column wider than right; right â‰ˆ 60% of left (5:3 ratio) */
		grid-template-columns: 5fr 3fr;
		grid-template-rows: auto auto;
		gap: 0;
		max-width: 98%;
		margin: 16px auto 0;
		padding: 0 16px;
		position: relative;
		z-index: 1;
	}

	.panel { padding: 36px 32px; min-height: 280px; }

	.mission { background: var(--section-light); }

	.pledge {
		background: var(--color-pledge-red);
		color: var(--color-pledge-red-text);
		display: grid;
		place-items: center;
		text-align: center;
	}

	.pledge .cta {
		background: var(--color-white);
		color: var(--color-pledge-cta-text);
		text-decoration: none;
		font-weight: 800;
		padding: 12px 18px;
		border-radius: 999px;
		box-shadow: inset 0 -2px 0 rgba(0,0,0,.2);
		transition: background .2s ease, color .2s ease, border-color .2s ease;
	}

	.pledge .cta:hover,
	.pledge .cta:focus-visible { background: var(--section-light); color: var(--color-pledge-cta-text); }

	.socials { background: var(--color-socials-green); color: var(--color-teal-ink); }
	.socials .link { color: var(--color-teal-ink); font-weight: 700; }

	.subscribe { background: var(--color-subscribe-dark); color: var(--color-subscribe-foreground); }
	.subscribe-form { display: flex; gap: 8px; margin-top: 8px; }
	.subscribe-form input {
		flex: 1;
		min-width: 0;
		padding: 10px 12px;
		border-radius: 8px;
		border: 1px solid var(--color-subscribe-input-border);
		background: var(--color-subscribe-input-bg);
		color: var(--color-subscribe-input-text);
	}
	.subscribe-form button {
		background: var(--color-accent);
		color: var(--color-teal-ink);
		border: 0;
		border-radius: 8px;
		padding: 10px 14px;
		font-weight: 800;
		transition: background-color 0.2s ease;
	}

	.subscribe-form button:hover {
		background: var(--color-donate-hover);
	}

	.subscribe-form button:disabled {
		opacity: 0.7;
		cursor: not-allowed;
	}

	.form-message {
		margin-top: 12px;
		padding: 8px 12px;
		border-radius: 6px;
		font-size: 0.9em;
		text-align: center;
	}

	.form-message.success {
		background: rgba(139, 230, 196, 0.2);
		border: 1px solid rgba(139, 230, 196, 0.4);
	}

	.form-message.error {
		background: rgba(207, 91, 79, 0.2);
		color: #fff4f2;
		border: 1px solid rgba(207, 91, 79, 0.4);
	}

	.link { display: inline-block; margin-top: 12px; font-weight: 700; color: var(--color-link-strong); }

	@media (max-width: 900px) {
		.panels { grid-template-columns: 1fr; }
		.panel { min-height: 220px; }
	}

	.activities-title {
		margin: 24px auto 0;
		text-align: center;
		color: var(--color-subscribe-dark);
		font-family: 'Lulo Clean Custom', 'Avenir Custom', Avenir, Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
		text-transform: uppercase;
		letter-spacing: .18em;
		font-size: clamp(18px, 3.2vw, 28px);
	}
</style>
